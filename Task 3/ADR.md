### Название задачи: Архитектура MVP онлайн-открытия депозитов
### Автор: Панкратов М.С.
### Дата: 14.07.2025

---

### Функциональные требования (Use Cases)

| №  | Действующие лица/системы    | Use Case                          | Описание                                                     |
|----|-----------------------------|-----------------------------------|--------------------------------------------------------------|
| 1  | Клиент                      | Подача заявки через сайт          | Ввод ФИО + телефона -> передача в кол-центр                  |
| 2  | Клиент                      | Подача заявки через интернет-банк | Выбор счёта + суммы -> SMS-подтверждение -> интеграция с АБС |
| 3  | Кол-центр                   | Обработка заявки                  | Звонок клиенту -> ручное подтверждение в АБС                 |

---

### Нефункциональные требования

| №  | Требование                          |
|----|-------------------------------------|
| 1  | Время отклика <500 мс для заявок    |
| 2  | Шифрование данных (HTTPS/TLS)       |
| 3  | Доступность 99.9%                   |

---

### Решение

Предлагаемое решение представляет собой гибридную асинхронную архитектуру, специально разработанную для безопасного и эффективного внедрения функционала онлайн-открытия депозитов в существующую ИТ-инфраструктуру банка. Основу решения составляет выделенный микросервис депозитов на Java Spring Boot, который выступает в роли буферного слоя между интернет-банком и устаревшей, но критически важной АБС. Этот микросервис берет на себя обработку онлайн-заявок, кэширование актуальных ставок в Redis и обеспечивает мгновенный отклик пользователям, гарантируя выполнение строгих требований к производительности.
Для минимизации нагрузки на АБС реализована асинхронная интеграция через Kafka, что позволяет отложенно синхронизировать данные с основной банковской системой без риска её перегрузки. Параллельно поддерживается и традиционный сценарий работы через кол-центр, где операторы могут вручную обрабатывать заявки непосредственно в АБС с последующей синхронизацией с микросервисом. СМС-уведомления клиентам отправляются как из микросервиса (подтверждение получения заявки), так и из АБС (финальное подтверждение открытия депозита), используя существующий SOAP-интерфейс СМС-шлюза.
Решение сохраняет полную совместимость с текущей ИТ-инфраструктурой банка, включая работу с унаследованными СУБД (Oracle для АБС и MS SQL для интернет-банка), и предусматривает возможность дальнейшего масштабирования. Такая архитектура не только решает текущие проблемы с производительностью и нагрузкой на АБС, но и закладывает фундамент для будущей цифровой трансформации, позволяя постепенно выносить дополнительный функционал в изолированные микросервисы без риска для стабильности основных банковских систем.

**Диаграммы:**

1. Диаграмма контекста  — взаимодействие систем.
2. Диаграмма контейнеров — детализация интернет-банка и АБС.

**Логика выбора:**

1. Чтобы избежать перегрузки АБС и увеличить скорость обработки заявок внедряем "Микросервис депозитов", который выступает буфером — обрабатывает онлайн-заявки асинхронно и передаёт данные в АБС через Kafka, снижая нагрузку. Микросервис изолирует новую логику депозитов, позволяя использовать современный стек (Java Spring Boot) и масштабироваться независимо от АБС. Так же микросервис сохраняет заявки в своём хранилище и синхронизирует их с АБС после ручного подтверждения.
2. Чтобы минимизировать риски для АБС используем асинхронную интеграцию через Kafka вместо прямых вызовов API АБС, так как АБС уже перегружена (требование R2 из FURPS+) и вертикальное масштабирование Oracle ограничено (ограничение +R3). Буферизация запросов снижает пиковые нагрузки на АБС.
3. Чтобы обеспечить производительность подключаем Redis для кэширования ставок (требование P1 <500 мс) и оптимизируем SQL-запросы к справочникам (требование P3 <200 мс). Эти решения позволяют достичь целевых показателей скорости без переработки legacy-кода АБС.
4. Чтобы соблюсти ограничения текущего IT-ландшафта используем существующие технологии (.NET для интернет-банка, Java для кол-центра) совместимые с текущими СУБД (MS SQL для интернет-банка, Oracle для АБС). Отказываемся от микросервисов (кроме изолированного модуля депозитов).из-за неготовности платформы.

---

### Альтернативы

1. **Прямая интеграция с АБС**
   - *Риски:* Перегрузка АБС, нарушение SLA.
2. **Ручная обработка без автоматизации**
   - *Недостатки:* Медленно, дорого.
